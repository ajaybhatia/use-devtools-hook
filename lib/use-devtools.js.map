{"version":3,"file":"use-devtools.js","sources":["../src/use-devtools.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react'\n\nexport function useDevtools([state, dispatch], initialState, name, reducer) {\n  const [devtools, setDevtools] = useState()\n  const skippedActionIds = useRef([])\n  const stagedActions = useRef([])\n\n  // Check if extension is loaded\n  const withDevtools =\n    typeof window !== 'undefined' &&\n    window.__USE_DEVTOOLS__ &&\n    window.__REDUX_DEVTOOLS_EXTENSION__ &&\n    window.devToolsExtension\n\n  // Toggle skipped action\n  function toggleAction({ id, state }) {\n    const liftedState = JSON.parse(state)\n    const idx = skippedActionIds.current.indexOf(id)\n    const skipped = idx !== -1\n\n    // Toggle action in dev tools ui\n    if (skipped) {\n      skippedActionIds.current.splice(idx, 1)\n      liftedState.skippedActionIds = skippedActionIds.current\n    } else {\n      skippedActionIds.current.push(id)\n      liftedState.skippedActionIds = skippedActionIds.current\n    }\n    return liftedState\n  }\n\n  function subscribeReducer(message) {\n    if (message.type === 'DISPATCH') {\n      switch (message.payload.type) {\n        case 'COMMIT': {\n          reducer({ type: 'COMMIT', payload: null })\n          return\n        }\n        case 'IMPORT_STATE': {\n          const { nextLiftedState } = message.payload\n          const { computedStates } = nextLiftedState\n          reducer({\n            type: 'IMPORT_STATE',\n            payload: computedStates[computedStates.length - 1].state,\n          })\n          devtools.send(null, nextLiftedState)\n          return\n        }\n        case 'JUMP_TO_STATE':\n          reducer({\n            type: 'JUMP_TO_ACTION',\n            payload: JSON.parse(message.state),\n          })\n          return\n        case 'JUMP_TO_ACTION': {\n          reducer({\n            type: 'JUMP_TO_ACTION',\n            payload: JSON.parse(message.state),\n          })\n          return\n        }\n        case 'RESET': {\n          devtools.init(initialState)\n          reducer({ type: 'RESET', payload: initialState })\n          return\n        }\n        case 'ROLLBACK': {\n          devtools.init(JSON.parse(message.state))\n          reducer({ type: 'ROLLBACK', payload: JSON.parse(message.state) })\n          return\n        }\n        case 'SWEEP': {\n          reducer({ type: 'SWEEP', payload: null })\n          return\n        }\n        case 'TOGGLE_ACTION': {\n          const liftedState = toggleAction({\n            id: message.payload.id,\n            state: message.state,\n          })\n          devtools.send(null, liftedState)\n\n          // Reset state\n          dispatch(initialState)\n\n          // Dispatch non skipped action\n          stagedActions.current.forEach((item, index) => {\n            skippedActionIds.current.indexOf(index + 1) === -1 && dispatch(item)\n          })\n\n          reducer({\n            type: 'TOGGLE_ACTION',\n            payload: {\n              id: message.payload.id,\n              state: JSON.parse(message.state),\n            },\n          })\n\n          return\n        }\n\n        default:\n          return\n      }\n    }\n  }\n\n  useEffect(\n    () => {\n      if (withDevtools && !devtools) {\n        // Connect to dev tools\n        setDevtools(\n          withDevtools.connect({\n            name,\n          })\n        )\n      }\n\n      if (devtools) {\n        // Set initial value\n        devtools.init(state)\n\n        // Subscribe to dev tools messages\n        devtools.subscribe(subscribeReducer)\n      }\n\n      return () => {\n        devtools && devtools.disconnect()\n      }\n    },\n    [devtools]\n  )\n\n  useEffect(\n    () => {\n      if (devtools) {\n        const devState = stagedActions.current[stagedActions.current.length - 1]\n\n        devState.type\n          ? devtools.send(devState.type, state)\n          : devtools.send(name ? `[${name}] UPDATE` : 'UPDATE', devState)\n      }\n    },\n    [stagedActions.current[stagedActions.current.length - 1]]\n  )\n\n  return [\n    state,\n    props => {\n      stagedActions.current.push(props)\n      dispatch(props)\n    },\n  ]\n}\n\nexport function useReducerDevtools([state, dispatch], initialState, name) {\n  function reducer(action) {\n    switch (action.type) {\n      case 'IMPORT_STATE':\n      case 'JUMP_TO_STATE':\n      case 'JUMP_TO_ACTION':\n      case 'RESET':\n      case 'ROLLBACK':\n        dispatch(action.payload)\n        return\n    }\n  }\n\n  return useDevtools([state, dispatch], initialState, name, reducer)\n}\n\nexport function useStateDevtools([state, dispatch], initialState, name) {\n  function reducer(action) {\n    switch (action.type) {\n      case 'IMPORT_STATE':\n      case 'JUMP_TO_STATE':\n      case 'JUMP_TO_ACTION':\n      case 'RESET':\n      case 'ROLLBACK':\n        dispatch(action.payload)\n        return\n    }\n  }\n\n  return useDevtools([state, dispatch], initialState, name, reducer)\n}\n"],"names":["useDevtools","initialState","name","reducer","state","dispatch","useState","devtools","setDevtools","skippedActionIds","useRef","stagedActions","withDevtools","window","__USE_DEVTOOLS__","__REDUX_DEVTOOLS_EXTENSION__","devToolsExtension","toggleAction","id","liftedState","JSON","parse","idx","current","indexOf","skipped","splice","push","subscribeReducer","message","type","payload","nextLiftedState","computedStates","length","send","init","forEach","item","index","useEffect","connect","subscribe","disconnect","devState","props","useReducerDevtools","action","useStateDevtools"],"mappings":"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"}