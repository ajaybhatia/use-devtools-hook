{"version":3,"file":"use-devtools.module.js","sources":["../src/use-devtools.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react'\n\nexport function useDevtools([state, dispatch], initialState, name, reducer) {\n  const [devtools, setDevtools] = useState()\n  const skippedActionIds = useRef([])\n  const stagedActions = useRef([])\n\n  // Check if extension is loaded\n  const withDevtools =\n    typeof window !== 'undefined' &&\n    window.__USE_DEVTOOLS__ &&\n    window.__REDUX_DEVTOOLS_EXTENSION__ &&\n    window.devToolsExtension\n\n  // Toggle skipped action\n  function toggleAction({ id, state }) {\n    const liftedState = JSON.parse(state)\n    const idx = skippedActionIds.current.indexOf(id)\n    const skipped = idx !== -1\n\n    // Toggle action in dev tools ui\n    if (skipped) {\n      skippedActionIds.current.splice(idx, 1)\n      liftedState.skippedActionIds = skippedActionIds.current\n    } else {\n      skippedActionIds.current.push(id)\n      liftedState.skippedActionIds = skippedActionIds.current\n    }\n    return liftedState\n  }\n\n  function subscribeReducer(message) {\n    if (message.type === 'DISPATCH') {\n      switch (message.payload.type) {\n        case 'COMMIT': {\n          reducer({ type: 'COMMIT', payload: null })\n          return\n        }\n        case 'IMPORT_STATE': {\n          const { nextLiftedState } = message.payload\n          const { computedStates } = nextLiftedState\n          reducer({\n            type: 'IMPORT_STATE',\n            payload: computedStates[computedStates.length - 1].state,\n          })\n          devtools.send(null, nextLiftedState)\n          return\n        }\n        case 'JUMP_TO_STATE':\n          reducer({\n            type: 'JUMP_TO_ACTION',\n            payload: JSON.parse(message.state),\n          })\n          return\n        case 'JUMP_TO_ACTION': {\n          reducer({\n            type: 'JUMP_TO_ACTION',\n            payload: JSON.parse(message.state),\n          })\n          return\n        }\n        case 'RESET': {\n          devtools.init(initialState)\n          reducer({ type: 'RESET', payload: initialState })\n          return\n        }\n        case 'ROLLBACK': {\n          devtools.init(JSON.parse(message.state))\n          reducer({ type: 'ROLLBACK', payload: JSON.parse(message.state) })\n          return\n        }\n        case 'SWEEP': {\n          reducer({ type: 'SWEEP', payload: null })\n          return\n        }\n        case 'TOGGLE_ACTION': {\n          const liftedState = toggleAction({\n            id: message.payload.id,\n            state: message.state,\n          })\n          devtools.send(null, liftedState)\n\n          // Reset state\n          dispatch(initialState)\n\n          // Dispatch non skipped action\n          stagedActions.current.forEach((item, index) => {\n            skippedActionIds.current.indexOf(index + 1) === -1 && dispatch(item)\n          })\n\n          reducer({\n            type: 'TOGGLE_ACTION',\n            payload: {\n              id: message.payload.id,\n              state: JSON.parse(message.state),\n            },\n          })\n\n          return\n        }\n\n        default:\n          return\n      }\n    }\n  }\n\n  useEffect(\n    () => {\n      if (withDevtools && !devtools) {\n        // Connect to dev tools\n        setDevtools(\n          withDevtools.connect({\n            name,\n          })\n        )\n      }\n\n      if (devtools) {\n        // Set initial value\n        devtools.init(state)\n\n        // Subscribe to dev tools messages\n        devtools.subscribe(subscribeReducer)\n      }\n    },\n    [devtools]\n  )\n\n  useEffect(\n    () => {\n      if (devtools) {\n        const devState = stagedActions.current[stagedActions.current.length - 1]\n\n        devState.type\n          ? devtools.send(devState.type, state)\n          : devtools.send(name ? `[${name}] UPDATE` : 'UPDATE', devState)\n      }\n    },\n    [stagedActions.current[stagedActions.current.length - 1]]\n  )\n\n  return [\n    state,\n    props => {\n      stagedActions.current.push(props)\n      dispatch(props)\n    },\n  ]\n}\n\nexport function useReducerDevtools([state, dispatch], initialState, name) {\n  function reducer(action) {\n    switch (action.type) {\n      case 'IMPORT_STATE':\n      case 'JUMP_TO_STATE':\n      case 'JUMP_TO_ACTION':\n      case 'RESET':\n      case 'ROLLBACK':\n        dispatch(action.payload)\n        return\n      default:\n        return\n    }\n  }\n\n  return useDevtools([state, dispatch], initialState, name, reducer)\n}\n\nexport function useStateDevtools([state, dispatch], initialState, name) {\n  function reducer(action) {\n    switch (action.type) {\n      case 'IMPORT_STATE':\n      case 'JUMP_TO_STATE':\n      case 'JUMP_TO_ACTION':\n      case 'RESET':\n      case 'ROLLBACK':\n        dispatch(action.payload)\n        return\n      default:\n        return\n    }\n  }\n\n  return useDevtools([state, dispatch], initialState, name, reducer)\n}\n"],"names":["useDevtools","initialState","name","reducer","state","dispatch","useState","devtools","setDevtools","skippedActionIds","useRef","stagedActions","withDevtools","window","__USE_DEVTOOLS__","__REDUX_DEVTOOLS_EXTENSION__","devToolsExtension","toggleAction","id","liftedState","JSON","parse","idx","current","indexOf","skipped","splice","push","subscribeReducer","message","type","payload","nextLiftedState","computedStates","length","send","init","forEach","item","index","useEffect","connect","subscribe","devState","props","useReducerDevtools","action","useStateDevtools"],"mappings":"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"}